<% layout('components/boilerplate.ejs') -%>
    <section>
        <div class="fairPlay">fair <img src="pictures/fair-play.png" alt=""> play</div>
        <p>FairPlayëŠ” ìŠ¤í¬ì¸ ë§¨ì‹­ì˜ ê°€ì¹˜ë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ë©°, ëª¨ë“  ì‚¬ìš©ìë“¤ì´ ê³µì •í•œ ê²½ê¸°ë¥¼ ì¦ê¸¸ ìˆ˜ ìˆë„ë¡ ìµœì„ ì„ ë‹¤í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>
            ê²½ê¸°ë¥¼ ì¡´ì¤‘í•˜ê³ , ìƒëŒ€ë¥¼ ì¡´ì¤‘í•˜ë©°, ìì‹ ì„ ì¡´ì¤‘í•˜ì„¸ìš”.<br>
            ëª¨ë‘ì™€ ì¦ê±°ìš´ ê²½ê¸°ë¥¼ í¼ì¹˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤!</p>
    </section>
    <section id="ad">
        <div class="gallery">
            <div id="carouselControls" class="gallery_body carousel carousel-dark slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#carouselIndicators" data-bs-slide-to="0" class="active"
                        aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#carouselIndicators" data-bs-slide-to="1"
                        aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#carouselIndicators" data-bs-slide-to="2"
                        aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item">
                        <img src="pictures/futsal.jpg" class="bannerImage d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item">
                        <img src="pictures/baseball.jpg" class="bannerImage d-block w-100" alt="...">
                    </div>
                    <div class="carousel-item active">
                        <img src="pictures/basketball.jpg" class="bannerImage d-block w-100" alt="...">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselControls"
                    data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselControls"
                    data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="weather row">
            <div class="col-md-6 firstText">
                <div class="current_temp col"></div>
                <div class="weather_description col"></div>
                <div class="city col"></div>
            </div>
            <div class="col-md-6 secondText">
                <div class="temp_min col"></div>
                <div class="temp_max col"></div>
                <div class="humidity col"></div>
                <div class="wind col"></div>
                <div class="cloud col"></div>
            </div>
            <script>
                var weatherIcon = {
                    '01': 'fas fa-sun',
                    '02': 'fas fa-cloud-sun',
                    '03': 'fas fa-cloud',
                    '04': 'fas fa-cloud-meatball',
                    '09': 'fas fa-cloud-sun-rain',
                    '10': 'fas fa-cloud-showers-heavy',
                    '11': 'fas fa-poo-storm',
                    '13': 'far fa-snowflake',
                    '50': 'fas fa-smog'
                };

                // ë‚ ì”¨ api - ì„œìš¸
                var apiURI = "http://api.openweathermap.org/data/2.5/weather?q=" + 'seoul' + "&appid=" + "9eca4cc6427c4042d2126324e3050e7c";
                $.ajax({
                    url: apiURI,
                    dataType: "json",
                    type: "GET",
                    async: "false",
                    success: function (resp) {
                        var $Icon = (resp.weather[0].icon).substr(0, 2);
                        var $weather_description = resp.weather[0].main;
                        var $Temp = Math.floor(resp.main.temp - 273.15) + 'Âº';
                        var $humidity = 'ìŠµë„&nbsp;&nbsp;&nbsp;&nbsp;' + resp.main.humidity + ' %';
                        var $wind = 'ë°”ëŒ&nbsp;&nbsp;&nbsp;&nbsp;' + resp.wind.speed + ' m/s';
                        var $city = 'ì„œìš¸';
                        var $cloud = 'êµ¬ë¦„&nbsp;&nbsp;&nbsp;&nbsp;' + resp.clouds.all + "%";
                        var $temp_min = 'ìµœì € ì˜¨ë„&nbsp;&nbsp;&nbsp;&nbsp;' + Math.floor(resp.main.temp_min - 273.15) + 'Âº';
                        var $temp_max = 'ìµœê³  ì˜¨ë„&nbsp;&nbsp;&nbsp;&nbsp;' + Math.floor(resp.main.temp_max - 273.15) + 'Âº';

                        $('.weather_icon').append(`<i class="` + weatherIcon[$Icon] + ` fa-5x" style="height : 150px; width : 150px;"></i>`);
                        $('.weather_description').prepend($weather_description);
                        $('.current_temp').prepend($Temp);
                        $('.humidity').prepend($humidity);
                        $('.wind').prepend($wind);
                        $('.city').append($city);
                        $('.cloud').append($cloud);
                        $('.temp_min').append($temp_min);
                        $('.temp_max').append($temp_max);
                    }
                })
            </script>
        </div>
    </section>

    <% if(!currentUser) { %>
        <script>
            function apply() {
                alert('ë¡œê·¸ì¸í•˜ì„¸ìš”!');
                return 0;
            }
        </script>
        <% } %>
            <section>
                <h2 class="m-5">ë‹¹ì¼ ì§„í–‰ ê²½ê¸°ğŸ“…</h2>
                <table class="table text-center">
                    <thead class="align-middle">
                        <tr>
                            <th scope="row" class="col-1">ì¢…ëª©</th>
                            <td class="col-2">ì‹œê°„</td>
                            <td class="col-1">ì§€ì—­</td>
                            <td class="col-4">ë‚´ìš©</td>
                            <td class="col-1">í‹°ì–´</td>
                            <td class="col-1">ì‘ì„±ì<br>(í˜ì–´ì ìˆ˜)</td>
                            <td class="col-2">ì‹ ì²­</td>
                        </tr>
                    </thead>
                    <tbody class="align-middle">
                        <% for(let product of products) { %>
                            <% if(product.time.getMonth() + 1===currentTime.month &&
                                product.time.getDate()===currentTime.date) { %>
                                <tr>
                                    <th scope="row">
                                        <% switch (product.sport) { case 'basketball' : %> ë†êµ¬ <% break; %>
                                               <% case 'baseball': %> ì•¼êµ¬ <% break; %>
                                                <%    case 'soccer': %> ì¶•êµ¬ <% break; %>
                                                  <%      case 'futsal': %> í’‹ì‚´ <% break; %>
                                                    <%        default: %> ê¸°íƒ€ <% break; %>
                                                                <% } %>
                                    </th>

                                    <td>
                                        <%=product.formattedDay%>
                                            <div class="time-highlight">
                                                <%=product.formattedTime%>
                                            </div>
                                    </td>
                                    <td>
                                        <%= product.area %>
                                    </td>
                                    <td>
                                        <%= product.contents %>
                                    </td>
                                    <td>
                                        <%= product.tier.charAt(0).toUpperCase() + product.tier.slice(1) %>
                                    </td>

                                    <td>
                                        <%= product.username %>(<%= product.fair_tier %>)
                                    </td>
                                    <td>
                                        <% if(!product.application) { %>
                                            <% if (currentUser) { %>
                                                <form action="/products/<%= product._id %>/apply" method="POST"
                                                    onsubmit="return confirm('ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                                    <button type="submit" class="applyButton">ì‹ ì²­í•˜ê¸°</button>
                                                </form>
                                                <% } else { %>
                                                    <button type="submit" class="applyButton"
                                                        onclick="apply()">ì‹ ì²­í•˜ê¸°</button>
                                                    <% } %>
                                                        <% } else {%>
                                                            <button class="disabledButton" disabled>ì‹ ì²­ ë§ˆê°</button>
                                                            <% } %>
                                    </td>
                                </tr>
                                <% } %>
                                    <% } %>
                    </tbody>
                </table>
            </section>